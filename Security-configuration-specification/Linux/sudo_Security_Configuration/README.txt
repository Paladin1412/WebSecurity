sudo安全配置规范



目录
1	 Sudo介绍	1
  1.1	Sudo简介	1
  1.2	应用场景	1
  1.3	Sudo命令使用方法	1
2	主要问题	2
  2.1	sudoer配置文件直接配置了高风险系统命令	2
  2.2	属于低权限用户的脚本或程序不能以高权限帐号运行	2
3	 Sudo安全配置	3
  3.1	配置示例	3
  3.2	命令分类	4
  3.3	限制访问范围	6
  3.4	不能配置sudo权限的命令	9
  3.5	禁止命令规避措施	11
  3.6	合理配置sudo执行命令的文件权限	12
  3.7	开启日志功能	12
  3.8	合理配置权限	13
  3.9	设置sudo文件权限	13
  3.10	排查可用sudo来执行的脚本的权限是否配置错误	13
  3.10.1 攻击原理	13
  3.10.2 正确的配置	14
  3.11	排查sudo里面配置的脚本或目录实际不存在	14
  3.12	Sudo测试分类和测试方法分类	14
  3.13	其他排查	16
4	防御方法推荐	17
5	SecureCAT工具排查说明	18
  5.1	其他安全选项	18
6	附录	19
  6.1	Sudo配置文件详解	19
  6.1.1 配置文件的组成	19
  6.1.2 配置规则	20
  6.1.3 默认参数	21
  6.2	案例	24
  6.2.1 场景1：脚本中直接调用执行低权限用户脚本	24
  6.2.2 场景2：脚本中从低权限配置文件中读取内容作为参数	25
  6.2.3 场景3：脚本将输入参数拼入路径，参数中传入相对路径	27
  6.2.4 场景4：脚本中的操作涉及低权限用户目录	28
  6.2.5 场景5：脚本中的校验和操作存在时间间隙	29
  6.2.6 场景6：脚本输入参数直接作为命令执行	31
  6.2.7 场景7：脚本直接引用外部输入作为路径，并对该路径下文件做属主、删除等操作	34
  6.2.8 场景8：脚本直接引用外部输入作为文件名，并对该文件进行cp操作	37
  6.2.9 场景9：脚本直接引用公共脚本中的某个函数，且公共脚本对当前用户拥有写权限。	39
  6.2.10 场景10：脚本直接引用外部输入作为路径，作为chown/chmod/rm 的参数	40
  6.2.11 场景11：脚本引入变量为内部目录/文件参数，且对该目录有属主/写操作	42
  6.2.12 场景12：脚本引入变量为内部目录/文件参数，但当前用户对该目录可写	43
  6.2.13 场景13：脚本执行过程中引入临时文件，并属主给当前user后执行mv操作	44
  6.2.14 场景14：脚本执行过程中引入脚本，但脚本路径为相对路径	45
  6.2.15 场景15：Sudo内定义可NOPassword的用户过多，利用其它用户身份间接提权	46

